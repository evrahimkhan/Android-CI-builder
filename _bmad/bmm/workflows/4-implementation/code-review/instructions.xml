<?xml version="1.0" encoding="UTF-8"?>
<workflow>
  <critical>This workflow performs adversarial senior developer code review</critical>
  <critical>Reviews code for quality, security, performance, architecture compliance, and test coverage</critical>
  
  <step n="1" goal="Load project context and architecture">
    <action>Load project context from: {project_context}</action>
    <action>Load architecture documentation from: {input_file_patterns.architecture.whole}</action>
    <action>Identify technology stack and architectural patterns</action>
    <action>Store architecture constraints and requirements</action>
  </step>

  <step n="2" goal="Identify code files to review">
    <action>Scan {story_dir} for code files matching project technology stack</action>
    <action>Create list of files to review prioritizing:</action>
    <action>- Core functionality files</action>
    <action>- Security-sensitive areas</action>
    <action>- Performance-critical components</action>
    <action>- Recently modified files</action>
  </step>

  <step n="3" goal="Perform adversarial code review">
    <critical>Apply senior developer review checklist:</critical>
    <action>Security Review:</action>
    <action>- Check for injection vulnerabilities</action>
    <action>- Verify input validation</action>
    <action>- Review authentication/authorization</action>
    <action>- Check for sensitive data exposure</action>
    
    <action>Code Quality Review:</action>
    <action>- Check for maintainability issues</action>
    <action>- Verify error handling</action>
    <action>- Review code duplication</action>
    <action>- Assess complexity metrics</action>
    
    <action>Performance Review:</action>
    <action>- Identify bottlenecks</action>
    <action>- Check resource usage</action>
    <action>- Review algorithm efficiency</action>
    
    <action>Architecture Review:</action>
    <action>- Verify compliance with architecture</action>
    <action>- Check for layer violations</action>
    <action>- Review dependency management</action>
    
    <action>Testing Review:</action>
    <action>- Assess test coverage</action>
    <action>- Check test quality</action>
    <action>- Verify edge cases covered</action>
  </step>

  <step n="4" goal="Document findings">
    <action>Create detailed report with:</action>
    <action>- Issue severity ranking (Critical, High, Medium, Low)</action>
    <action>- Specific file locations and line numbers</action>
    <action>- Recommended fixes</action>
    <action>- Risk assessment</action>
    <action>Minimum 3-10 specific issues must be identified</action>
  </step>

  <step n="5" goal="Prioritize issues">
    <action>Rank issues by:</action>
    <action>- Security impact</action>
    <action>- Functional correctness</action>
    <action>- Maintainability</action>
    <action>- Performance impact</action>
  </step>

  <step n="6" goal="Generate recommendations">
    <action>Provide specific, actionable recommendations</action>
    <action>Include code snippets for fixes where appropriate</action>
    <action>Reference best practices and standards</action>
  </step>
</workflow>