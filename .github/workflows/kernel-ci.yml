name: Android Kernel CI

on:
  workflow_dispatch:
    inputs:
      codename:
        required: true
        description: Device codename
      defconfig:
        required: true
        description: Kernel defconfig
      kernel_repo:
        required: true
        description: Kernel source URL
      kernel_branch:
        required: true
        description: Kernel branch
      enable_kernelsu:
        type: boolean
        default: false
        description: Enable KernelSU-Next

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y bc bison flex build-essential \
            libssl-dev libelf-dev python3 git curl zip ccache

      - name: Run kernel CI
        env:
          TG_TOKEN: ${{ secrets.TG_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        run: |
          chmod +x scripts/ci.sh
          scripts/ci.sh \
            "${{ github.event.inputs.codename }}" \
            "${{ github.event.inputs.defconfig }}" \
            "${{ github.event.inputs.kernel_repo }}" \
            "${{ github.event.inputs.kernel_branch }}" \
            "${{ github.event.inputs.enable_kernelsu }}"
